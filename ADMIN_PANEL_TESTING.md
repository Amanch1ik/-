# Тестирование админ панели YESS Loyalty

## Быстрый старт

### 1. Подготовка Backend

```bash
cd yess-backend

# Установить зависимости (если еще не установлены)
pip install -r requirements.txt

# Создать тестового администратора
python3 create_admin.py

# Запустить backend сервер
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

Backend будет доступен на: **http://localhost:8000**

### 2. Подготовка Frontend (Админ панель)

```bash
cd admin-panel

# Установить зависимости (если еще не установлены)
npm install

# Запустить dev сервер
npm run dev
```

Админ панель будет доступна на: **http://localhost:3001**

## Тестовые данные

### Администратор
- **Email**: `admin@yess-loyalty.com`
- **Password**: `admin123456`

### Тестовые пользователи
- `user1@test.com` до `user10@test.com`
- **Password**: `password123`
- Пользователи 9 и 10 заблокированы для тестирования

## Что тестировать

### ✅ 1. Аутентификация

1. Открыть http://localhost:3001
2. Должна открыться страница логина
3. Ввести креды администратора
4. Должен произойти вход и редирект на Dashboard

**Проверить:**
- Форма логина отображается корректно
- Валидация полей работает
- При неверных данных показывается ошибка
- При успешном входе сохраняется токен

### ✅ 2. Dashboard (Главная страница)

**Проверить:**
- Карточки со статистикой отображаются
- Графики загружаются
- Таблица последних транзакций показывается
- Цифры обновляются при обновлении страницы

### ✅ 3. Управление пользователями

Перейти в раздел "Пользователи"

**Проверить:**
- Список пользователей отображается
- Поиск работает (ввести "user1")
- Пагинация функционирует
- Кнопки блокировки/разблокировки работают
- Можно открыть детали пользователя

**Тест сценарий:**
1. Найти user1@test.com через поиск
2. Нажать "Заблокировать"
3. Проверить, что статус изменился на "Заблокирован"
4. Нажать "Разблокировать"
5. Проверить, что статус вернулся в "Активен"

### ✅ 4. Управление партнерами

Перейти в раздел "Партнеры"

**Проверить:**
- Список партнеров загружается
- Фильтры работают
- Можно открыть карточку партнера
- Кнопка верификации работает

**Примечание:** Партнеры нужно создать через основное API или seed скрипт

### ✅ 5. Транзакции

Перейти в раздел "Транзакции"

**Проверить:**
- Таблица транзакций отображается
- Фильтры по типу и статусу работают
- Можно отсортировать по дате
- Кнопка экспорта присутствует

### ✅ 6. Уведомления

Перейти в раздел "Уведомления"

**Проверить:**
- Список уведомлений показывается
- Кнопка "Отправить уведомление" открывает модальное окно
- Форма создания уведомления работает
- Можно выбрать тип и целевую аудиторию

**Тест сценарий:**
1. Нажать "Отправить уведомление"
2. Заполнить форму:
   - Заголовок: "Тестовое уведомление"
   - Сообщение: "Это тест"
   - Тип: Push
   - Аудитория: Все пользователи
3. Нажать "Отправить"
4. Проверить, что уведомление появилось в списке

### ✅ 7. Акции и промо-кампании

Перейти в раздел "Акции"

**Проверить:**
- Список акций отображается
- Кнопка "Создать акцию" работает
- Форма создания содержит все поля
- Можно редактировать существующую акцию

**Тест сценарий:**
1. Нажать "Создать акцию"
2. Заполнить форму:
   - Название: "Тестовая акция"
   - Категория: Общая
   - Тип: Процентная скидка
   - Скидка: 10%
   - Период: выбрать даты
3. Сохранить
4. Проверить, что акция появилась в списке

### ✅ 8. Аналитика

Перейти в раздел "Аналитика"

**Проверить:**
- Все графики отображаются
- Диаграммы рендерятся корректно
- Можно выбрать период
- Фильтры работают

### ✅ 9. Настройки

Перейти в раздел "Настройки"

**Проверить:**
- Вкладки переключаются
- Формы заполнены значениями
- Кнопка "Сохранить" работает
- Показывается сообщение об успехе

## Проверка API endpoints

### Используя Swagger UI

1. Открыть http://localhost:8000/docs
2. Найти раздел "Панель администратора"
3. Попробовать вызвать endpoints:
   - GET `/api/admin/dashboard/stats`
   - GET `/api/admin/users`
   - GET `/api/admin/partners`
   - GET `/api/admin/transactions`

### Используя curl

```bash
# Получить токен (сначала нужно залогиниться)
TOKEN="your_jwt_token_here"

# Получить статистику дашборда
curl -X GET "http://localhost:8000/api/admin/dashboard/stats" \
  -H "Authorization: Bearer $TOKEN"

# Получить список пользователей
curl -X GET "http://localhost:8000/api/admin/users?page=1&limit=10" \
  -H "Authorization: Bearer $TOKEN"

# Заблокировать пользователя
curl -X POST "http://localhost:8000/api/admin/users/1/block" \
  -H "Authorization: Bearer $TOKEN"
```

## Проверка интеграции

### Frontend ↔ Backend

1. В админ панели открыть DevTools (F12)
2. Перейти на вкладку Network
3. Выполнить любое действие (например, загрузить пользователей)
4. Проверить:
   - Запрос уходит на `http://localhost:8000`
   - Токен добавляется в заголовок Authorization
   - Ответ приходит с кодом 200
   - Данные корректно отображаются в UI

### Supabase интеграция

1. Проверить, что в `.env` указаны правильные credentials
2. Проверить подключение к Supabase:

```javascript
// В консоли браузера
console.log(import.meta.env.VITE_SUPABASE_URL);
// Должен вывести URL Supabase
```

## Известные проблемы и решения

### Problem: "Network Error" в админ панели
**Решение:** Убедиться, что backend запущен на порту 8000

### Problem: "401 Unauthorized"
**Решение:**
1. Проверить, что токен сохраняется в localStorage
2. Убедиться, что пользователь имеет роль admin
3. Проверить срок действия токена

### Problem: Данные не загружаются
**Решение:**
1. Открыть DevTools → Console
2. Проверить ошибки
3. Проверить Network tab для неудачных запросов

### Problem: Backend не запускается
**Решение:**
```bash
# Проверить установку зависимостей
pip list | grep fastapi

# Проверить порт
lsof -i :8000

# Убить процесс если занят
kill -9 <PID>
```

## Контрольный чеклист

- [ ] Backend запущен на 8000
- [ ] Admin panel запущена на 3001
- [ ] Создан администратор через create_admin.py
- [ ] Успешный вход в админ панель
- [ ] Dashboard показывает статистику
- [ ] Список пользователей загружается
- [ ] Можно заблокировать/разблокировать пользователя
- [ ] Можно создать уведомление
- [ ] Можно создать акцию
- [ ] Графики в аналитике отображаются
- [ ] API endpoints отвечают в Swagger
- [ ] Network requests проходят успешно

## Следующие шаги

После успешного тестирования:

1. **Заполнить реальными данными**
   - Импортировать пользователей
   - Добавить партнеров
   - Создать транзакции

2. **Настроить продакшн**
   - Изменить пароль администратора
   - Настроить HTTPS
   - Настроить CORS для продакшн домена

3. **Деплой**
   - Backend на сервер
   - Frontend на CDN или static hosting
   - Настроить CI/CD

## Полезные команды

```bash
# Остановить все процессы
pkill -f uvicorn
pkill -f vite

# Проверить логи backend
tail -f yess-backend/logs/app.log

# Очистить кэш npm
cd admin-panel && rm -rf node_modules package-lock.json && npm install

# Пересобрать админ панель
cd admin-panel && npm run build
```

## Поддержка

При возникновении проблем:
1. Проверьте логи backend
2. Проверьте консоль браузера
3. Убедитесь, что все env переменные настроены
4. Проверьте, что порты свободны

---

**© 2025 YESS Loyalty System**
